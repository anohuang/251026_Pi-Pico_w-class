# Raspberry Pi Pico - 可變電阻控制觀念

## 📋 概述

本文件說明在 Raspberry Pi Pico 上使用**可變電阻（Potentiometer）**進行類比輸入控制的核心觀念，包含 ADC 原理、電路設計與程式實作要點。

---

## 🔧 可變電阻的基本原理

### 什麼是可變電阻？

可變電阻是一種**可調整阻值**的電子元件，透過旋轉旋鈕或滑動滑桿來改變電阻值。在電路中，它通常作為**分壓器（Voltage Divider）**使用。

### 結構與接腳

```
        可變電阻（Potentiometer）
        ┌─────────────────┐
        │    旋轉旋鈕      │
        │       ◯         │
        └────┬──┬──┬──────┘
             │  │  │
            VCC OUT GND
            (1) (2) (3)

腳位說明：
- 腳位 1 (VCC)：接電源正極 (3.3V)
- 腳位 2 (OUT)：輸出訊號（中間抽頭，可變動）
- 腳位 3 (GND)：接地
```

### 工作原理（分壓原理）

可變電阻內部可以視為兩個電阻的串聯：

```
    3.3V (VCC)
      │
      ┴ R1 (上半部電阻，可變)
      │
      ├──── GPIO 26 (輸出電壓 Vout)
      │
      ┴ R2 (下半部電阻，可變)
      │
    GND

輸出電壓公式：
Vout = VCC × (R2 / (R1 + R2))

旋轉旋鈕的效果：
- 轉到最左：R1 ≈ 0, R2 = 最大 → Vout ≈ 3.3V
- 轉到中間：R1 = R2 → Vout ≈ 1.65V
- 轉到最右：R1 = 最大, R2 ≈ 0 → Vout ≈ 0V
```

**關鍵觀念**：旋轉旋鈕會改變 R1 和 R2 的比例，進而改變輸出電壓。

---

## ⚡ ADC（類比數位轉換器）核心觀念

### 為什麼需要 ADC？

微控制器（如 Pico）只能處理**數位訊號**（0 或 1），但可變電阻輸出的是**類比訊號**（連續變化的電壓值）。ADC 的作用就是將類比電壓轉換成數位數值。

### 類比 vs 數位訊號

| 訊號類型 | 特性 | 範例 | 處理方式 |
|---------|------|------|---------|
| **數位訊號** | 只有 0 和 1 兩種狀態 | 按鈕、LED 開關 | GPIO 直接讀取 |
| **類比訊號** | 連續變化的數值 | 溫度、亮度、可變電阻 | 需要 ADC 轉換 |

### Pico 的 ADC 規格

| 項目 | 規格 | 說明 |
|------|------|------|
| **ADC 解析度** | 12 位元 | 理論上可分辨 4096 個階層 |
| **`read_u16()` 回傳值** | 16 位元 (0-65535) | 實際讀取範圍 |
| **輸入電壓範圍** | 0V ~ 3.3V | **絕對不可超過！** |
| **可用 ADC 腳位** | GPIO 26, 27, 28 | 僅這三個腳位支援 ADC |

### ⚠️ 重要安全注意事項

> **Pico 的 ADC 最大輸入電壓為 3.3V！**
> 
> 絕對不可以將 5V 訊號直接連接到 ADC 腳位，這會導致 Pico 永久損壞！
> 
> 如果需要量測 5V 訊號，必須使用分壓電路。

---

## 🔌 硬體接線觀念

### 接線圖

```
Raspberry Pi Pico
    ┌─────────────────────┐
    │                     │
    │  3.3V ──────────────┼──── 可變電阻 VCC (腳位1)
    │                     │
    │  GPIO 26 (ADC0) ────┼──── 可變電阻 OUT (腳位2)
    │                     │
    │  GND ───────────────┼──── 可變電阻 GND (腳位3)
    │                     │
    └─────────────────────┘
```

### 接線要點

1. **VCC 接 3.3V**：提供參考電壓
2. **OUT 接 ADC 腳位**：讀取分壓後的電壓值
3. **GND 接地**：形成完整迴路

### 為什麼使用 3.3V 而不是 5V？

- Pico 的 ADC 最大輸入電壓為 3.3V
- 使用 3.3V 作為參考電壓，可以充分利用 ADC 的完整範圍
- 如果使用 5V，需要額外的分壓電路，會增加複雜度

---

## 📝 程式設計觀念

### 基本讀取流程

```python
from machine import ADC, Pin
from time import sleep

# 1. 初始化 ADC
potentiometer = ADC(Pin(26))

# 2. 讀取原始數值
raw_value = potentiometer.read_u16()  # 0 ~ 65535

# 3. 轉換為實際電壓
voltage = raw_value * 3.3 / 65535  # 0V ~ 3.3V

# 4. 轉換為百分比
percentage = raw_value * 100 / 65535  # 0% ~ 100%
```

### 數值轉換的觀念

#### 1. 原始數值（Raw Value）

```python
raw_value = potentiometer.read_u16()  # 0 ~ 65535
```

- ADC 直接回傳的數值
- 範圍：0（對應 0V）到 65535（對應 3.3V）
- 這是程式中最常使用的數值

#### 2. 電壓轉換

```python
voltage = raw_value * 3.3 / 65535
```

**轉換公式**：
```
電壓 = (原始值 / 最大值) × 參考電壓
     = (raw_value / 65535) × 3.3V
```

**範例**：
- `raw_value = 0` → `voltage = 0V`
- `raw_value = 32768` → `voltage = 1.65V`（中間值）
- `raw_value = 65535` → `voltage = 3.3V`

#### 3. 百分比轉換

```python
percentage = raw_value * 100 / 65535
```

**轉換公式**：
```
百分比 = (原始值 / 最大值) × 100%
       = (raw_value / 65535) × 100%
```

**範例**：
- `raw_value = 0` → `percentage = 0%`
- `raw_value = 32768` → `percentage = 50%`
- `raw_value = 65535` → `percentage = 100%`

#### 4. 映射到自訂範圍

```python
def map_value(x, in_min, in_max, out_min, out_max):
    """將數值從一個範圍映射到另一個範圍"""
    return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min

# 範例：映射到 0-180 度（用於伺服馬達）
angle = map_value(raw_value, 0, 65535, 0, 180)
```

**映射公式**：
```
輸出值 = (輸入值 - 輸入最小值) × (輸出範圍) / (輸入範圍) + 輸出最小值
```

**範例**：
- `raw_value = 0` → `angle = 0°`
- `raw_value = 32768` → `angle = 90°`
- `raw_value = 65535` → `angle = 180°`

---

## 🎯 實際應用觀念

### 應用一：控制 LED 亮度（PWM）

**觀念**：將 ADC 讀值直接對應到 PWM 的 duty cycle

```python
from machine import ADC, Pin, PWM

potentiometer = ADC(Pin(26))
led = PWM(Pin(15))
led.freq(1000)  # 設定 PWM 頻率

while True:
    adc_value = potentiometer.read_u16()
    led.duty_u16(adc_value)  # 直接使用 ADC 值
```

**關鍵觀念**：
- ADC 值範圍：0 ~ 65535
- PWM duty cycle 範圍：0 ~ 65535
- 兩者範圍相同，可以直接對應

### 應用二：控制馬達速度

**觀念**：將 ADC 值映射到馬達速度範圍

```python
# 假設馬達速度範圍是 0-100%
speed_percent = potentiometer.read_u16() * 100 / 65535
motor_pwm.duty_u16(int(speed_percent * 65535 / 100))
```

### 應用三：選單選擇

**觀念**：將連續的 ADC 值轉換為離散的選項

```python
raw_value = potentiometer.read_u16()
# 將 0-65535 分成 5 個選項
option = int(raw_value / (65535 / 5))  # 0, 1, 2, 3, 4
```

---

## 🔍 常見問題與解決觀念

### 問題一：數值不穩定（抖動）

**現象**：讀取的數值持續微幅跳動

**原因**：
- ADC 本身的雜訊
- 電源不穩定
- 電路中的電磁干擾

**解決觀念：平均濾波**

```python
def read_average(adc, samples=10):
    """讀取多次取平均值，減少雜訊"""
    total = 0
    for _ in range(samples):
        total += adc.read_u16()
    return total // samples
```

**觀念**：多次讀取取平均，可以過濾掉隨機雜訊，得到更穩定的數值。

### 問題二：最大值和最小值不正確

**現象**：旋到底卻無法達到 0 或 65535

**原因**：
- 可變電阻品質問題
- 接線不良
- 電阻值範圍限制

**解決觀念：校正（Calibration）**

```python
# 先記錄實際的最小值和最大值
ADC_MIN = 300    # 實際最小值
ADC_MAX = 65200  # 實際最大值

def calibrated_read(adc):
    raw = adc.read_u16()
    # 限制在校正範圍內
    raw = max(ADC_MIN, min(ADC_MAX, raw))
    # 映射到 0-65535
    return int((raw - ADC_MIN) * 65535 / (ADC_MAX - ADC_MIN))
```

**觀念**：記錄實際可達到的範圍，然後重新映射到完整範圍。

### 問題三：響應速度慢

**現象**：旋轉可變電阻時，系統反應遲緩

**原因**：
- 使用平均濾波時，取樣次數太多
- 主迴圈延遲時間太長

**解決觀念**：
- 減少平均濾波的取樣次數
- 減少主迴圈的延遲時間
- 使用非阻塞式設計

---

## 📊 ADC 精度觀念

### 理論 vs 實際精度

| 項目 | 理論值 | 實際值 | 說明 |
|------|--------|--------|------|
| **位元數** | 12 bit | ~9-10 bit | 實際有效位元數較低 |
| **解析度** | 4096 階 | 512-1024 階 | 實際可分辨的階層 |
| **電壓精度** | 0.8mV/階 | 3-6mV/階 | 每階對應的電壓差 |

### 為什麼實際精度較低？

1. **雜訊影響**：電路中的雜訊會降低有效位元數
2. **電源品質**：不穩定的電源會影響 ADC 精度
3. **溫度漂移**：溫度變化會影響 ADC 的準確性

### 提升精度的方法

1. **過採樣（Oversampling）**：多次讀取後平均
2. **穩定的電源**：使用乾淨的 3.3V 電源
3. **適當的接地**：避免接地迴路
4. **遠離雜訊源**：避免靠近馬達、開關電源

---

## 🎓 核心觀念總結

### 1. 分壓原理

可變電阻透過改變電阻比例來改變輸出電壓，這是所有類比控制的基礎。

### 2. ADC 轉換

ADC 將連續的類比電壓轉換成離散的數位數值，讓微控制器可以處理類比訊號。

### 3. 數值映射

將 ADC 讀值（0-65535）映射到實際應用需要的範圍（電壓、百分比、角度等）。

### 4. 雜訊處理

使用平均濾波、校正等方法來提高讀值的穩定性和準確性。

### 5. 範圍限制

了解 ADC 的電壓限制（0-3.3V），避免損壞硬體。

---

## 🔄 程式設計流程觀念

```
1. 初始化 ADC
   ↓
2. 讀取原始數值 (0-65535)
   ↓
3. 轉換為所需格式
   ├─ 電壓值 (0-3.3V)
   ├─ 百分比 (0-100%)
   └─ 自訂範圍 (例如：0-180度)
   ↓
4. 應用轉換後的數值
   ├─ 控制 PWM 亮度
   ├─ 控制馬達速度
   └─ 選單選擇等
   ↓
5. 重複步驟 2-4
```

---

## 📚 延伸學習

### 相關元件

| 元件 | 說明 | 與可變電阻的關係 |
|------|------|----------------|
| **光敏電阻** | 根據光線強度改變阻值 | 同樣使用 ADC 讀取 |
| **溫度感測器** | 輸出類比電壓 | 同樣使用 ADC 讀取 |
| **滑桿電位器** | 線性可變電阻 | 結構不同但原理相同 |

### 進階應用

1. **多個可變電阻**：同時讀取多個 ADC 通道
2. **數位可變電阻**：使用數位電位器（I2C/SPI）
3. **觸控感測**：使用電容式觸控代替機械式可變電阻

---

## ✅ 觀念檢查清單

- [ ] 理解可變電阻的分壓原理
- [ ] 了解 ADC 的作用與限制
- [ ] 掌握數值轉換的方法（電壓、百分比、映射）
- [ ] 知道如何處理數值不穩定的問題
- [ ] 了解校正的概念與方法
- [ ] 理解 ADC 精度與實際應用的關係

---

## 📅 更新紀錄

- **2025-12-14**：初版完成，專注於可變電阻控制的核心觀念

